from scapy.all import *
import sys
import ipaddress
import socket

conf.verb = 0

class PortFound:
    def __init__(self, port, banner):
        self.port = port
        self.banner = banner


class ScanIP:
    def __init__(self, ip):
        self.ip = str(ip)
        self.ports = []

    def scan(self):

        for port in range(1, 5000):

            s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
            s.settimeout(1)

            try:
                s.connect((self.ip, int(port)))
            except:
                why = 1
            else:
                
                try:
                    banner = s.recv(124)
                except:
                    banner = "No banner found"
                
                portFound = PortFound(port, banner)
                self.ports.append(portFound)

scan_ips = []
input_ips = str(sys.argv[1])

for ip in ipaddress.IPv4Network(input_ips):
    scan_ip = ScanIP(ip)
    scan_ips.append(scan_ip)

print("Starting port_scanner.py with " + str(len(scan_ips)) + " IPs.\nThis could take a while...")


for scan_ip in scan_ips:
    scan_ip.scan()

    if len(scan_ip.ports) > 0:
        print("\n\n")
        print(scan_ip.ip)
        for port in scan_ip.ports:
            print("  ", port.port)
            print("    Banner: ", port.banner)
            print("    Service:", socket.getservbyport(port.port))
            
            

            

